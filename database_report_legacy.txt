================================================================================
REPORTE COMPLETO DE BASE DE DATOS POSTGRESQL - ACTUALIZADO
================================================================================
Generado: 2025-09-26 10:07:41

INFORMACION GENERAL DE LA BASE DE DATOS
--------------------------------------------------
Nombre de la base de datos: defaultdb
Version de PostgreSQL: PostgreSQL 16.10 (Debian 16.10-1.pgdg13+1) on x86_64-pc-linux-gnu, compiled by gcc (Debian 14.2.0-19) 14.2.0, 64-bit
Tamano de la base de datos: 10 MB

ESQUEMAS DISPONIBLES
------------------------------
- app
- public

TABLAS Y ESTRUCTURA DETALLADA
-----------------------------------

Tabla: bicicletas
   Esquema: app
   Filas: 0
   Tamano: 8192 bytes
   Columnas:
     - id: integer NOT NULL [PK]
     - numero: integer NOT NULL
     - descripcion: character varying
     - estado: character varying DEFAULT 'activa'::character varying

Tabla: chat_kv
   Esquema: app
   Filas: 0
   Tamano: 16 kB
   Columnas:
     - wa_id: character varying NOT NULL [PK]
     - k: character varying NOT NULL [PK]
     - v: text
     - updated_at: timestamp without time zone NOT NULL DEFAULT CURRENT_TIMESTAMP

Tabla: chat_memory
   Esquema: app
   Filas: 0
   Tamano: 40 kB
   Columnas:
     - turno_id: bigint NOT NULL [PK]
     - wa_id: character varying NOT NULL [PK]
     - role: character varying NOT NULL
     - content: text NOT NULL
     - created_at: timestamp without time zone NOT NULL DEFAULT CURRENT_TIMESTAMP

Tabla: classes
   Esquema: app
   Filas: 0
   Tamano: 8192 bytes
   Columnas:
     - id: integer NOT NULL [PK]
     - hora: character varying NOT NULL
     - descripcion: character varying

Tabla: configuracion
   Esquema: app
   Filas: 0
   Tamano: 64 kB
   Columnas:
     - id: integer NOT NULL [PK]
     - clave: character varying NOT NULL
     - valor: text
     - tipo: character varying DEFAULT 'string'::character varying
     - descripcion: character varying
     - grupo: character varying
     - fecha_creacion: timestamp without time zone DEFAULT CURRENT_TIMESTAMP
     - fecha_modificacion: timestamp without time zone DEFAULT CURRENT_TIMESTAMP
     - es_secreto: smallint DEFAULT 0

Tabla: contacts
   Esquema: app
   Filas: 0
   Tamano: 64 kB
   Columnas:
     - id: bigint NOT NULL [PK]
     - wa_id: character varying NOT NULL
     - phone_number: character varying NOT NULL
     - name: character varying
     - profile_name: character varying
     - created_at: timestamp without time zone DEFAULT CURRENT_TIMESTAMP
     - updated_at: timestamp without time zone DEFAULT CURRENT_TIMESTAMP
     - is_saved: smallint NOT NULL DEFAULT 0

Tabla: conversations
   Esquema: app
   Filas: 0
   Tamano: 40 kB
   Columnas:
     - id: bigint NOT NULL [PK]
     - contact_id: bigint NOT NULL [FK]
     - status: character varying NOT NULL DEFAULT 'active'::character varying
     - expiration_timestamp: timestamp without time zone
     - created_at: timestamp without time zone DEFAULT CURRENT_TIMESTAMP
     - updated_at: timestamp without time zone DEFAULT CURRENT_TIMESTAMP

Tabla: interactive_responses
   Esquema: app
   Filas: 0
   Tamano: 8192 bytes
   Columnas:
     - id: bigint NOT NULL [PK]
     - message_id: bigint NOT NULL [FK]
     - interactive_type: character varying NOT NULL
     - title: character varying
     - button_payload: character varying
     - list_id: character varying
     - section_id: character varying
     - created_at: timestamp without time zone DEFAULT CURRENT_TIMESTAMP

Tabla: leads
   Esquema: app
   Filas: 0
   Tamano: 48 kB
   Columnas:
     - id: integer NOT NULL [PK]
     - persona_id: integer NOT NULL [FK]
     - fecha_contacto: timestamp without time zone NOT NULL DEFAULT CURRENT_TIMESTAMP
     - convertido: smallint NOT NULL DEFAULT 0
     - source: character varying NOT NULL DEFAULT 'whatsapp'::character varying

Tabla: media
   Esquema: app
   Filas: 0
   Tamano: 16 kB
   Columnas:
     - id: bigint NOT NULL [PK]
     - message_id: bigint NOT NULL [FK]
     - media_type: character varying NOT NULL
     - mime_type: character varying
     - sha256: character varying
     - filename: character varying
     - file_size: bigint
     - media_url: character varying
     - caption: text
     - created_at: timestamp without time zone DEFAULT CURRENT_TIMESTAMP
     - downloaded: smallint
     - download_time: timestamp without time zone
     - download_failed: smallint DEFAULT 0

Tabla: members
   Esquema: app
   Filas: 0
   Tamano: 48 kB
   Columnas:
     - id: integer NOT NULL [PK]
     - persona_id: integer NOT NULL [FK]
     - fecha_registro: timestamp without time zone NOT NULL DEFAULT CURRENT_TIMESTAMP
     - email: character varying
     - consent_promos: smallint NOT NULL DEFAULT 0
     - consent_record: smallint NOT NULL DEFAULT 0

Tabla: memberships
   Esquema: app
   Filas: 0
   Tamano: 16 kB
   Columnas:
     - id: integer NOT NULL [PK]
     - nombre: character varying NOT NULL
     - precio: numeric NOT NULL
     - descripcion: text
     - duracion: integer
     - tipo_duracion: character varying NOT NULL

Tabla: message_statuses
   Esquema: app
   Filas: 0
   Tamano: 80 kB
   Columnas:
     - id: bigint NOT NULL [PK]
     - message_id: bigint NOT NULL [FK]
     - status: character varying NOT NULL
     - timestamp: timestamp without time zone NOT NULL
     - created_at: timestamp without time zone DEFAULT CURRENT_TIMESTAMP

Tabla: messages
   Esquema: app
   Filas: 0
   Tamano: 872 kB
   Columnas:
     - id: bigint NOT NULL [PK]
     - wa_message_id: character varying
     - conversation_id: bigint NOT NULL [FK]
     - contact_id: bigint NOT NULL [FK]
     - direction: character varying NOT NULL
     - message_type: character varying NOT NULL
     - text_content: text
     - template_id: bigint [FK]
     - context_message_id: character varying
     - timestamp: timestamp without time zone NOT NULL
     - created_at: timestamp without time zone DEFAULT CURRENT_TIMESTAMP
     - is_processed: smallint DEFAULT 0
     - processed_at: timestamp without time zone
     - is_temp: smallint DEFAULT 0

Tabla: pagos
   Esquema: app
   Filas: 0
   Tamano: 184 kB
   Columnas:
     - id: integer NOT NULL [PK]
     - id_member: integer NOT NULL [FK]
     - monto: numeric NOT NULL
     - fecha_pago: timestamp without time zone NOT NULL
     - id_membership: integer NOT NULL [FK]
     - id_usuario_registro: integer NOT NULL [FK]
     - tipo_pago: character varying NOT NULL
     - comentario: text
     - mp_payment_id: character varying
     - external_reference: character varying
     - webhook_received_at: timestamp without time zone
     - status: character varying DEFAULT 'COMPLETED'::character varying

Tabla: personas
   Esquema: app
   Filas: 0
   Tamano: 56 kB
   Columnas:
     - id: integer NOT NULL [PK]
     - telefono: character varying NOT NULL
     - nombre_origen: character varying
     - wa_id: character varying
     - creado_en: timestamp without time zone NOT NULL DEFAULT CURRENT_TIMESTAMP
     - actualizado_en: timestamp without time zone NOT NULL DEFAULT CURRENT_TIMESTAMP

Tabla: reservas
   Esquema: app
   Filas: 0
   Tamano: 88 kB
   Columnas:
     - id: integer NOT NULL [PK]
     - id_member: integer NOT NULL [FK]
     - id_bicicleta: integer NOT NULL [FK]
     - id_class: integer NOT NULL [FK]
     - fecha_inicio: timestamp without time zone NOT NULL
     - fecha_fin: timestamp without time zone NOT NULL
     - id_membership: integer NOT NULL [FK]
     - fecha_creacion: timestamp without time zone DEFAULT CURRENT_TIMESTAMP
     - clave_idempotencia: character varying

Tabla: sessions
   Esquema: app
   Filas: 53
   Tamano: 56 kB
   Columnas:
     - id: integer NOT NULL [PK]
     - refresh_token: character varying NOT NULL
     - session: character varying NOT NULL
     - device_name: character varying
     - ip_address: inet
     - last_active_at: timestamp with time zone
     - revoked_at: timestamp with time zone
     - user_agent: character varying
     - user_id: integer NOT NULL [FK]
     - created_at: timestamp without time zone DEFAULT CURRENT_TIMESTAMP
     - updated_at: timestamp without time zone
     - deleted_at: timestamp without time zone

Tabla: users
   Esquema: app
   Filas: 0
   Tamano: 16 kB
   Columnas:
     - id: integer NOT NULL [PK]
     - username: character varying NOT NULL
     - password: character varying NOT NULL
     - role: character varying NOT NULL DEFAULT 'usuario'::character varying
     - created_at: timestamp without time zone DEFAULT CURRENT_TIMESTAMP
     - updated_at: timestamp without time zone
     - role_id: integer [FK]
     - deleted_at: timestamp without time zone DEFAULT NULL::timestamp without time zone

Tabla: users_roles
   Esquema: app
   Filas: 0
   Tamano: 16 kB
   Columnas:
     - id: integer NOT NULL [PK]
     - role: character varying NOT NULL
     - description: character varying
     - created_at: timestamp without time zone DEFAULT CURRENT_TIMESTAMP
     - updated_at: timestamp without time zone

Tabla: webhook_logs
   Esquema: app
   Filas: 0
   Tamano: 88 kB
   Columnas:
     - id: bigint NOT NULL [PK]
     - event_type: character varying NOT NULL
     - x_request_id: character varying
     - payload: json
     - processed: smallint DEFAULT 1
     - created_at: timestamp without time zone DEFAULT CURRENT_TIMESTAMP

Tabla: whatsapp_templates
   Esquema: app
   Filas: 0
   Tamano: 40 kB
   Columnas:
     - id: bigint NOT NULL [PK]
     - template_name: character varying NOT NULL
     - template_namespace: character varying NOT NULL
     - template_language: character varying NOT NULL
     - template_status: character varying NOT NULL
     - components: json
     - created_at: timestamp without time zone DEFAULT CURRENT_TIMESTAMP
     - updated_at: timestamp without time zone DEFAULT CURRENT_TIMESTAMP

INDICES PERSONALIZADOS
----------------------
- idx_sessions_last_active en tabla sessions

ESTADISTICAS DE LA BASE DE DATOS
----------------------------------------
Estadisticas de conexion y rendimiento:
   - Conexiones activas: 7
   - Transacciones confirmadas: 3899
   - Transacciones revertidas: 159
   - Bloques leidos: 546
   - Bloques en cache: 122436

RESUMEN EJECUTIVO
-------------------------
- Total de esquemas: 2 (app, public)
- Total de tablas: 22
- Total de vistas: 0
- Total de indices personalizados: 1
- Total de conexiones activas: 7

CAMBIOS DETECTADOS (desde ultimo reporte)
-----------------------------------------
- Actualizacion del esquema de tabla sessions:
  * Campo ip_address cambio de character varying a inet
  * Campo last_active_at cambio de character varying a timestamp with time zone
  * Campo revoked_at cambio de character varying a timestamp with time zone
- Adicion de indice idx_sessions_last_active en tabla sessions
- Limpieza de datos: todas las tablas muestran 0 filas (excepto sessions con 53)

RECOMENDACIONES PARA OPTIMIZACION
---------------------------------
1. CREAR VISTA PARA SOCIOS:
   CREATE VIEW app.vista_socios_completa AS
   SELECT
       m.id as member_id,
       p.nombre_origen as nombre,
       p.telefono,
       m.email,
       m.fecha_registro,
       ms.nombre as tipo_membresia,
       ms.precio,
       ms.duracion,
       ms.tipo_duracion,
       CASE
           WHEN pg.fecha_pago IS NOT NULL THEN
               pg.fecha_pago + INTERVAL ms.duracion || ' ' || ms.tipo_duracion
           ELSE NULL
       END as fecha_vencimiento
   FROM app.members m
   JOIN app.personas p ON m.persona_id = p.id
   LEFT JOIN app.pagos pg ON pg.id_member = m.id
   LEFT JOIN app.memberships ms ON pg.id_membership = ms.id
   WHERE m.deleted_at IS NULL;

2. INDICES ADICIONALES RECOMENDADOS:
   - CREATE INDEX idx_members_persona_id ON app.members(persona_id);
   - CREATE INDEX idx_pagos_member_id ON app.pagos(id_member);
   - CREATE INDEX idx_pagos_fecha ON app.pagos(fecha_pago);
   - CREATE INDEX idx_reservas_member_date ON app.reservas(id_member, fecha_inicio);

3. MEJORAS DE RENDIMIENTO:
   - Considerar particionado de tabla messages por fecha
   - Agregar indices compuestos para consultas frecuentes
   - Implementar archivado de datos historicos en webhook_logs

================================================================================
FIN DEL REPORTE
================================================================================